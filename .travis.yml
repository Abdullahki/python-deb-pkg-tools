sudo: required
language: python
python:
  - "2.6"
  - "2.7"
  - "3.4"
  - "3.5"
  - "pypy"
# Install the dependencies of deb-pkg-tools before running the test suite.
# For more information about the nasty /dev/random hack, please see:
# https://github.com/travis-ci/travis-ci/issues/1913#issuecomment-33891474
before_install:
  - sudo apt-get update -qq
  - sudo apt-get install --yes dpkg-dev fakeroot lintian python-apt rng-tools
  - sudo rm -f /dev/random
  - sudo mknod -m 0666 /dev/random c 1 9
  - echo HRNGDEVICE=/dev/urandom | sudo tee /etc/default/rng-tools
  - sudo /etc/init.d/rng-tools restart
# Install the Python dependencies and our own package.
install:
  - pip install pip-accel
  - pip-accel install coveralls
  - pip-accel install --requirement=requirements.txt
  - pip-accel install --requirement=requirements-checks.txt
  - pip-accel install --requirement=requirements-tests.txt
  - LC_ALL=C pip-accel install .
# Run the test suite as root so that all tests run (even the `dangerous ones').
script:
  - make check
  - sudo -E make test
# Submit coverage statistics to coveralls.io after successful runs.
after_success:
  - coveralls
# Don't test tags.
branches:
  except:
    - /^[0-9]/
